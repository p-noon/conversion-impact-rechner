<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marketing-Hebel-Rechner</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial,sans-serif;background:#f4f4f6;padding:20px}
.simulator{max-width:950px;margin:40px auto;background:#fff;border-radius:24px;box-shadow:0 8px 20px rgba(0,0,0,0.08);padding:28px;color:#111}
h1{text-align:center;font-size:1.8rem;margin:0 0 8px}
.subtitle{text-align:center;color:#666;margin-bottom:22px}
.input-grid{display:flex;gap:24px;flex-wrap:wrap}
.column{flex:1;min-width:280px}
label{display:block;margin-top:12px;margin-bottom:6px;color:#444;font-size:0.95rem}
input[type="number"],input[readonly]{width:100%;padding:10px;border-radius:10px;border:1px solid #d2d2d7;background:#f9f9f9;box-sizing:border-box;font-size:1rem}
input[readonly]{background:#f0f0f0}
.results{margin-top:26px;display:flex;gap:14px;flex-wrap:wrap}
.result-card{background:#f6f7fb;padding:14px;border-radius:12px;text-align:center;flex:1;min-width:120px}
.result-card h2{margin:8px 0;font-size:1.6rem;color:#0071e3}
.result-card.alt h2{color:#333}
.delta{font-size:0.85rem;margin-top:4px}
.delta.positive{color:#0a8f00}
.delta.negative{color:#d70015}
.slider-section{margin-top:28px;padding-top:18px;border-top:1px solid #e6e6ee;display:flex;flex-direction:column;gap:20px}
.slider-wrapper{position:relative;text-align:center}
.slider-label-inline{font-weight:600;color:#0071e3;font-size:1rem}
.slider-value{display:inline-block;margin-left:6px;font-weight:700;color:#0071e3;white-space:nowrap}
input[type="range"]{width:100%;accent-color:#0071e3;cursor:pointer;margin-top:8px}
footer{margin-top:20px;text-align:center;color:#999;font-size:13px}
footer a{color:#0071e3;text-decoration:none}
footer a:hover{text-decoration:underline}

/* Overlay fÃ¼r Einbettung */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:999}
.overlay-content{background:#fff;padding:24px;border-radius:16px;width:90%;max-width:600px;box-shadow:0 10px 30px rgba(0,0,0,0.2)}
.overlay-content textarea{width:100%;height:120px;font-family:monospace;border-radius:8px;border:1px solid #ccc;padding:8px}
.close-btn{background:#0071e3;color:white;border:none;padding:8px 16px;border-radius:8px;margin-top:12px;cursor:pointer}
.close-btn:hover{background:#0a84ff}
</style>
</head>
<body>

<div class="simulator">
  <h1>Marketing-Hebel-Rechner</h1>
  <p class="subtitle">Simuliere, wie sich Ã„nderungen bei Kassenzettel und Conversion Rate auf Umsatz & Ertrag auswirken.</p>

  <div class="input-grid">
    <div class="column">
      <h3>Grunddaten</h3>
      <label>Umsatz (EUR)</label>
      <input id="baseRevenue" type="number" step="0.01" placeholder="z.B. 1000">
      <label>Conversion Rate (%)</label>
      <input id="baseCR" type="number" step="0.01" placeholder="z.B. 2">
      <label>Ertrag (optional, EUR)</label>
      <input id="baseProfit" type="number" step="0.01" placeholder="z.B. 200">
    </div>

    <div class="column">
      <h3>Bon & Kosten</h3>
      <label>Brutto-Bon pro Bestellung (EUR)</label>
      <input id="grossBon" type="number" step="0.01" placeholder="z.B. 50">
      <label>Netto (automatisch)</label>
      <input id="netBon" readonly>
      <label>Herstellungskosten pro Bestellung (EUR)</label>
      <input id="prodCost" type="number" step="0.01" placeholder="z.B. 20">
      <label>Verpackung & Versand (EUR)</label>
      <input id="shipCost" type="number" step="0.01" placeholder="z.B. 5">
    </div>
  </div>

  <div class="slider-section" id="sliders">
    <div class="slider-wrapper">
      <span class="slider-label-inline">Neuer Bon:</span>
      <span id="sliderBonValue" class="slider-value"></span>
      <input id="sliderBon" type="range">
    </div>
    <div class="slider-wrapper">
      <span class="slider-label-inline">Neue CR (%):</span>
      <span id="sliderCRValue" class="slider-value"></span>
      <input id="sliderCR" type="range">
    </div>
  </div>

  <div class="results">
    <div class="result-card">
      <p>Gesamtumsatz</p>
      <h2 id="totalRevenue">â€“</h2>
    </div>
    <div class="result-card alt">
      <p>Gesamtertrag</p>
      <h2 id="totalProfit">â€“</h2>
    </div>
    <div class="result-card">
      <p>Besucherzahl</p>
      <h2 id="visitors">â€“</h2>
    </div>
  </div>

  <div class="results">
    <div class="result-card">
      <p>Zusatz-Umsatz</p>
      <h2 id="addRevenue">0 â‚¬</h2>
    </div>
    <div class="result-card alt">
      <p>Zusatz-Ertrag</p>
      <h2 id="addProfit">0 â‚¬</h2>
    </div>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>ðŸ”— Rechner einbetten / teilen</strong></a> â€“ entwickelt von 
    <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h3>Einbettungscode:</h3>
    <textarea readonly><iframe src="https://p-noon.github.io/marketing-hebel-rechner/" width="100%" height="950" style="border:none;"></iframe></textarea>
    <button class="close-btn" id="closeOverlay">SchlieÃŸen</button>
  </div>
</div>

<script>
function fmt(n){return isFinite(n)?n.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}):"â€“";}
function round(n){return Math.round(n);}

// Basis-Objekt
let base={};

function updateNetBon(){
  const gross = +document.getElementById("grossBon").value||0;
  document.getElementById("netBon").value = gross?fmt(gross/1.19)+" â‚¬":"";
  setBase();
}

// Basis setzen bei Eingabe
function setBase(){
  const revenue = +document.getElementById("baseRevenue").value||0;
  const cr = (+document.getElementById("baseCR").value||0)/100;
  const profitInput = +document.getElementById("baseProfit").value;
  const grossBon = +document.getElementById("grossBon").value||0;
  const netBon = grossBon/1.19;
  const prod = +document.getElementById("prodCost").value||0;
  const ship = +document.getElementById("shipCost").value||0;

  if(!revenue || !cr || !grossBon) return;

  const visitors = revenue / (cr * grossBon);

  base={revenue, cr, profitInput, grossBon, netBon, prod, ship, visitors};

  // Slider setzen
  const sliderBon = document.getElementById("sliderBon");
  const sliderCR = document.getElementById("sliderCR");

  sliderBon.min = grossBon*0.5;
  sliderBon.max = grossBon*1.5;
  sliderBon.step = 0.1;
  sliderBon.value = grossBon;
  sliderBon.dataset.center = grossBon;

  sliderCR.min = Math.max(0, (base.cr*100)-3);
  sliderCR.max = (base.cr*100)+3;
  sliderCR.step = 0.01;
  sliderCR.value = base.cr*100;
  sliderCR.dataset.center = base.cr*100;

  document.getElementById("sliderBonValue").textContent = fmt(grossBon);
  document.getElementById("sliderCRValue").textContent = fmt(base.cr*100);

  updateResults(0,0);
  updateTotals();
}

// Update Totale
function updateTotals(){
  if(!base.revenue) return;
  document.getElementById("totalRevenue").textContent = fmt(base.revenue)+" â‚¬";
  document.getElementById("visitors").textContent = round(base.visitors);
  document.getElementById("totalProfit").textContent = isFinite(base.profitInput)?fmt(base.profitInput)+" â‚¬":"â€“";
}

// Slider-Update
function updateScenario(){
  if(!base.revenue) return;
  const newBon = +document.getElementById("sliderBon").value||0;
  const newCR = (+document.getElementById("sliderCR").value||0)/100;

  document.getElementById("sliderBonValue").textContent = fmt(newBon);
  document.getElementById("sliderCRValue").textContent = fmt(newCR*100);

  const deltaRevenue = base.visitors*newCR*(newBon-base.grossBon);
  let deltaProfit = deltaRevenue;
  if(isFinite(base.profitInput)){
    deltaProfit = base.visitors*newCR*((newBon/1.19 - base.prod - base.ship) - (base.profitInput/base.visitors));
  }

  updateResults(deltaRevenue, deltaProfit);
}

function updateResults(deltaRev, deltaProf){
  document.getElementById("addRevenue").textContent = fmt(deltaRev)+" â‚¬";
  document.getElementById("addProfit").textContent = fmt(deltaProf)+" â‚¬";
}

// Eventlistener
['baseRevenue','baseCR','baseProfit','grossBon','prodCost','shipCost'].forEach(id=>{
  document.getElementById(id).addEventListener('input',updateNetBon);
});

document.getElementById("sliderBon").addEventListener('input',updateScenario);
document.getElementById("sliderCR").addEventListener('input',updateScenario);
document.querySelectorAll('input[type="range"]').forEach(slider=>{
  slider.addEventListener("dblclick",()=>{if(slider.dataset.center){slider.value=slider.dataset.center;updateScenario();}});
});

// Overlay
document.getElementById("embedLink").addEventListener("click",e=>{
  e.preventDefault();
  document.getElementById("overlay").style.display="flex";
});
document.getElementById("closeOverlay").addEventListener("click",()=>{document.getElementById("overlay").style.display="none";});
</script>

</body>
</html>
