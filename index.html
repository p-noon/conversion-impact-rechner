<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marketing-Hebel-Rechner</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial,sans-serif;background:#f4f4f6;padding:20px}
.simulator{max-width:950px;margin:40px auto;background:#fff;border-radius:24px;box-shadow:0 8px 20px rgba(0,0,0,0.08);padding:28px;color:#111}
h1{text-align:center;font-size:1.8rem;margin:0 0 8px}
.subtitle{text-align:center;color:#666;margin-bottom:22px}
.input-grid{display:flex;gap:24px;flex-wrap:wrap}
.column{flex:1;min-width:280px}
label{display:block;margin-top:12px;margin-bottom:6px;color:#444;font-size:0.95rem}
input[type="number"],input[readonly]{width:100%;padding:10px;border-radius:10px;border:1px solid #d2d2d7;background:#f9f9f9;box-sizing:border-box;font-size:1rem}
input[readonly]{background:#f0f0f0}
.button-main{margin-top:22px;width:100%;background:#0071e3;color:#fff;border:none;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;display:none}
.results{margin-top:26px;display:block}
.result-grid{display:grid;gap:14px}
.result-card{background:#f6f7fb;padding:14px;border-radius:12px;text-align:center}
.result-card h2{margin:8px 0;font-size:1.6rem;color:#0071e3}
.result-card.alt h2{color:#333}
.helper{font-size:0.88rem;color:#666;margin-top:8px}
.delta{font-size:0.85rem;margin-top:4px}
.delta.positive{color:#0a8f00}
.delta.negative{color:#d70015}
.slider-section{margin-top:28px;padding-top:18px;border-top:1px solid #e6e6ee;display:block}
.slider-wrapper{position:relative;margin-top:20px;margin-bottom:20px;text-align:center}
.slider-label-inline{font-weight:600;color:#0071e3;font-size:1rem}
.slider-value{display:inline-block;margin-left:6px;font-weight:700;color:#0071e3;white-space:nowrap}
input[type="range"]{width:100%;accent-color:#0071e3;cursor:pointer;margin-top:8px}
.radio-wrap{display:flex;align-items:center;gap:8px;margin-top:8px}
footer{margin-top:20px;text-align:center;color:#999;font-size:13px}
footer a{color:#0071e3;text-decoration:none}
footer a:hover{text-decoration:underline}
</style>
</head>
<body>

<div class="simulator">
  <h1>Marketing-Hebel-Rechner</h1>
  <p class="subtitle">Simuliere, wie sich Ã„nderungen bei Kassenzettel und Conversion Rate auf Zusatz-Umsatz & Zusatz-Ertrag auswirken.</p>

  <div class="input-grid">
    <div class="column">
      <h3>Grunddaten</h3>
      <label>Gesamtumsatz (EUR)</label>
      <input id="totalRevenueInput" type="number" step="0.01" placeholder="z. B. 100.000">
      <label>Conversion Rate (%)</label>
      <input id="conversionRateInput" type="number" step="0.01" placeholder="z. B. 2">
      <label>Ertrag (optional, EUR)</label>
      <input id="profit" type="number" step="0.01" placeholder="z. B. 20.000">
      <div class="radio-wrap">
        <input type="checkbox" id="autoEstimate">
        <label for="autoEstimate">Ertrag automatisch ergÃ¤nzen</label>
      </div>
    </div>

    <div class="column">
      <h3>Kassenbon-Daten</h3>
      <label>Bruttobon (EUR)</label>
      <input id="grossBon" type="number" step="0.01" placeholder="z. B. 50">
      <label>Netto-Bon (automatisch)</label>
      <input id="netBon" readonly>
      <label>Herstellungskosten pro Bestellung (EUR)</label>
      <input id="productionCost" type="number" step="0.01" placeholder="z. B. 20">
      <label>Verpackung & Versand (EUR)</label>
      <input id="shippingCost" type="number" step="0.01" placeholder="z. B. 5">
    </div>
  </div>

  <div class="slider-section" id="scenarioSection">
    <h3>Szenario anpassen</h3>

    <div class="slider-wrapper">
      <span class="slider-label-inline">Neuer Kassenbon:</span>
      <span id="receiptValue" class="slider-value"></span>
      <input id="sliderReceipt" type="range" step="0.01">
    </div>

    <div class="slider-wrapper">
      <span class="slider-label-inline">Neue Conversion Rate:</span>
      <span id="crValue" class="slider-value"></span>
      <input id="sliderCr" type="range" step="0.01">
    </div>

    <div class="result-grid" style="grid-template-columns:1fr 1fr;gap:14px;margin-top:20px;">
      <div class="result-card">
        <p>Zusatz-Umsatz</p>
        <h2 id="additionalRevenue">0</h2>
        <div id="deltaRevenue" class="delta"></div>
      </div>
      <div class="result-card alt">
        <p>Zusatz-Ertrag</p>
        <h2 id="additionalProfit">0</h2>
        <div id="deltaProfit" class="delta"></div>
        <div id="visitorsDisplay" class="helper"></div>
      </div>
    </div>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>ðŸ”— Rechner einbetten / teilen</strong></a> â€“ entwickelt von 
    <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h3>Einbettungscode:</h3>
    <textarea readonly><iframe src="https://p-noon.github.io/marketing-hebel-rechner/" width="100%" height="950" style="border:none;"></iframe></textarea>
    <button class="close-btn" id="closeOverlay">SchlieÃŸen</button>
  </div>
</div>

<script>
function fmt(num){return isFinite(num)?num.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}):"0";}
function calcBase(){
  const totalRevenue=+document.getElementById("totalRevenueInput").value||0;
  const crPct=+document.getElementById("conversionRateInput").value||0;
  const cr=crPct/100;
  const profitInput=+document.getElementById("profit").value||0;
  const grossBon=+document.getElementById("grossBon").value||0;
  const netBon=grossBon/1.19;
  document.getElementById("netBon").value=fmt(netBon);

  const production=+document.getElementById("productionCost").value||0;
  const shipping=+document.getElementById("shippingCost").value||0;

  const orders=cr>0?totalRevenue/(cr*grossBon):0;

  base={
    totalRevenue,totalProfit:profitInput,
    grossBon,netBon,production,shipping,
    crPct,cr,orders
  };

  // Slider initialisieren
  const recSlider=document.getElementById("sliderReceipt");
  recSlider.min=grossBon*0.5; recSlider.max=grossBon*1.5; recSlider.value=grossBon; recSlider.dataset.center=grossBon;
  document.getElementById("receiptValue").textContent=fmt(grossBon);

  const crSlider=document.getElementById("sliderCr");
  crSlider.min=Math.max(0,crPct-3); crSlider.max=crPct+3; crSlider.value=crPct; crSlider.dataset.center=crPct;
  document.getElementById("crValue").textContent=fmt(crPct);

  updateScenario();
}

function updateScenario(){
  if(!base)return;
  const newBon=+document.getElementById("sliderReceipt").value||0;
  const newCrPct=+document.getElementById("sliderCr").value||0;
  const newCr=newCrPct/100;

  document.getElementById("receiptValue").textContent=fmt(newBon);
  document.getElementById("crValue").textContent=fmt(newCrPct);

  // Besucherzahl
  const visitors=base.orders;
  document.getElementById("visitorsDisplay").textContent="Besucher (gerundet): "+Math.round(visitors);

  // Zusatz-Umsatz
  const addRevenue=visitors*newCr*newBon - base.totalRevenue;
  document.getElementById("additionalRevenue").textContent=fmt(addRevenue)+" â‚¬";
  const deltaRevPct=base.totalRevenue>0?(addRevenue/base.totalRevenue*100).toFixed(2):"â€“";
  document.getElementById("deltaRevenue").textContent=(addRevenue>=0?"+":"")+deltaRevPct+"%";
  document.getElementById("deltaRevenue").className="delta "+(addRevenue>=0?"positive":"negative");

  // Zusatz-Ertrag
  let addProfit=0;
  if(base.totalProfit>0){
    const share=base.production/base.grossBon;
    const profitPerOrder=newBon - (newBon*share) - base.shipping;
    addProfit=profitPerOrder*visitors*newCr - base.totalProfit;
    const deltaProfitPct=(base.totalProfit>0?(addProfit/base.totalProfit*100).toFixed(2):"â€“");
    document.getElementById("deltaProfit").textContent=(addProfit>=0?"+":"")+deltaProfitPct+"%";
  } else {
    const share=base.production/base.grossBon;
    const profitPerOrder=newBon - (newBon*share) - base.shipping;
    addProfit=profitPerOrder*visitors*newCr;
    document.getElementById("deltaProfit").textContent="";
  }
  document.getElementById("additionalProfit").textContent=fmt(addProfit)+" â‚¬";
  document.getElementById("additionalProfit").style.color=addProfit<0?"#d70015":"#0071e3";
}

// Events
['totalRevenueInput','conversionRateInput','profit','grossBon','productionCost','shippingCost'].forEach(id=>{
  document.getElementById(id).addEventListener('input',calcBase);
});
document.getElementById("sliderReceipt").addEventListener("input",updateScenario);
document.getElementById("sliderCr").addEventListener("input",updateScenario);
document.querySelectorAll('input[type="range"]').forEach(slider=>{
  slider.addEventListener("dblclick",()=>{if(slider.dataset.center){slider.value=slider.dataset.center;updateScenario();}});
});
document.getElementById("autoEstimate").addEventListener("change",()=>{
  if(document.getElementById("autoEstimate").checked){
    if(!document.getElementById("profit").value){
      const grossBon=+document.getElementById("grossBon").value||0;
      const production=+document.getElementById("productionCost").value||0;
      const shipping=+document.getElementById("shippingCost").value||0;
      const netBon=grossBon/1.19;
      const share=production/grossBon;
      const orders=(+document.getElementById("totalRevenueInput").value||0)/(+document.getElementById("conversionRateInput").value/100*grossBon);
      const profitPerOrder=netBon-(netBon*share)-shipping;
      document.getElementById("profit").value=Math.round(profitPerOrder*orders);
    }
  } else {
    document.getElementById("profit").value="";
  }
});

// Overlay
document.getElementById("embedLink").addEventListener("click",e=>{e.preventDefault();document.getElementById("overlay").style.display="flex";});
document.getElementById("closeOverlay").addEventListener("click",()=>{document.getElementById("overlay").style.display="none";});

// initial
calcBase();
</script>

</body>
</html>
