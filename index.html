<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Umsatz & Ertrag Simulator</title>
<style>
  .spaced-br {
  display: block;      /* macht den <br> wie ein Blockelement */
  margin-top: 10px;     /* Abstand über der neuen Zeile */
}
body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial,sans-serif;background:#f4f4f6;padding:20px}
.simulator{max-width:950px;margin:40px auto;background:#fff;border-radius:24px;box-shadow:0 8px 20px rgba(0,0,0,0.08);padding:28px;color:#111}
h1{text-align:center;font-size:1.8rem;margin:0 0 8px}
.subtitle{text-align:center;color:#666;margin-bottom:22px}
.input-grid{display:flex;gap:24px;flex-wrap:wrap}
.column{flex:1;min-width:280px}
label{display:block;margin-top:12px;margin-bottom:6px;color:#444;font-size:0.95rem}
input[type="text"],input[type="number"],input[readonly]{width:100%;padding:10px;border-radius:10px;border:1px solid #d2d2d7;background:#f9f9f9;box-sizing:border-box;font-size:1rem}
input[readonly]{background:#f0f0f0}
.radio-wrap{display:flex;align-items:center;gap:6px;margin-top:10px;font-size:0.9rem;color:#444}
.radio-wrap input[type="checkbox"]{width:18px;height:18px;border-radius:50%;accent-color:#0071e3;margin:0;cursor:pointer}
.results{margin-top:26px}
.result-grid{display:grid;gap:14px;grid-template-columns:1fr 1fr;margin-top:20px}
.result-card{background:#f6f7fb;padding:18px;border-radius:14px;text-align:center}
.result-card h2{margin:8px 0;font-size:1.8rem;color:#0071e3;cursor:pointer}
.delta{font-size:0.85rem;margin-top:4px}
.delta.positive{color:#0a8f00}
.delta.negative{color:#d70015}
.subtext{font-size:0.85rem;color:#666;margin-top:4px}
.slider-section{margin-top:24px;padding-top:18px;border-top:1px solid #e6e6ee}
.slider-wrapper{position:relative;margin-top:28px;margin-bottom:28px;text-align:center}
.slider-label-inline{font-weight:600;color:#0071e3;font-size:1rem}
.slider-value{display:inline-block;margin-left:6px;font-weight:700;color:#0071e3;white-space:nowrap}
input[type="range"]{width:100%;accent-color:#0071e3;cursor:pointer;margin-top:8px}
.reset-btn{position:absolute;right:4px;top:-4px;cursor:pointer;font-size:18px;color:#0071e3;user-select:none}
footer{margin-top:20px;text-align:center;color:#999;font-size:13px}
footer a{color:#0071e3;text-decoration:none}
footer a:hover{text-decoration:underline}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:999}
.overlay-content{background:#fff;padding:24px;border-radius:16px;width:90%;max-width:600px;box-shadow:0 10px 30px rgba(0,0,0,0.2)}
.overlay-content textarea{width:100%;height:120px;font-family:monospace;border-radius:8px;border:1px solid #ccc;padding:8px}
.close-btn{background:#0071e3;color:white;border:none;padding:8px 16px;border-radius:8px;margin-top:12px;cursor:pointer}
.close-btn:hover{background:#0a84ff}
/* 📱 Nur mobil: Ergebnis-Kacheln untereinander */
@media (max-width: 600px){
  .result-grid{grid-template-columns:1fr;}
  .reset-btn{right:0;top:-18px;}
}
</style>
</head>
<body>

<div class="simulator">
  <h1>Umsatz & Ertrag Simulator</h1>
<p class="subtitle">
  Simuliere, wie sich Änderungen bei durchschnittlichem Bestellwert und Conversion Rate auf deinen Umsatz & Ertrag auswirken.<br class="spaced-br">
  1. Schritt: Aktuelle Daten deines Onlineshops eintragen.<br class="spaced-br">
  2. Schritt: Zukünftigen Umsatz und Ertrag simulieren.
</p>

  <div class="input-grid">
    <div class="column">
      <label>Gesamtumsatz (EUR)</label>
      <input id="totalRevenue" type="text" placeholder="z. B. 120.000">
      <label>Conversion Rate (%)</label>
      <input id="conversionRate" type="text" placeholder="z. B. 2,5">
      <label>Gesamtertrag (optional, EUR)</label>
      <input id="profit" type="text" placeholder="z. B. 20.000">
      <div class="radio-wrap">
        <input type="checkbox" id="autoEstimate">
        <label for="autoEstimate">Ertrag automatisch ergänzen</label>
      </div>
      <div class="helper" id="visitorDisplay">–</div>
    </div>

    <div class="column">
      <label>Ø Bestellwert (Brutto, EUR)</label>
      <input id="bonGross" type="text" placeholder="z. B. 60">
      <label>Ø Bestellwert (Netto, automatisch)</label>
      <input id="bonNet" type="text" readonly>
      <label> Ø Herstellungskosten (EUR)</label>
      <input id="productionCost" type="text" placeholder="z. B. 20">
      <label> Ø Versandkosten (EUR)</label>
      <input id="shippingCost" type="text" placeholder="z. B. 5">
    </div>
  </div>

  <div class="slider-section">
    <div class="slider-wrapper">
      <span class="slider-label-inline">Neuer Ø Bestellwert:</span>
      <span id="bonValue" class="slider-value">–</span>
      <span class="reset-btn" id="resetBon">⟲</span>
      <input id="sliderBon" type="range" min="0" max="20000" step="1">
    </div>

    <div class="slider-wrapper">
      <span class="slider-label-inline">Neue Conversion Rate:</span>
      <span id="crValue" class="slider-value">–</span>
      <span class="reset-btn" id="resetCr">⟲</span>
      <input id="sliderCr" type="range" min="0" max="10" step="0.01">
    </div>

    <div class="result-grid">
      <div class="result-card">
        <p>Zusätzlicher Umsatz</p>
        <h2 id="deltaRevenueAbs">–</h2>
        <div id="deltaRevenueRel" class="delta"></div>
        <div id="newRevenueTotal" class="subtext"></div>
      </div>
      <div class="result-card">
        <p>Zusätzlicher Ertrag</p>
        <h2 id="deltaProfitAbs">–</h2>
        <div id="deltaProfitRel" class="delta"></div>
        <div id="newProfitTotal" class="subtext"></div>
      </div>
    </div>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>🔗 Rechner einbetten / teilen</strong></a> – entwickelt von 
    <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-content">
    <h3>Einbettungscode:</h3>
    <textarea readonly><iframe src="https://p-noon.github.io/marketing-hebel-rechner/" width="100%" height="950" style="border:none;"></iframe></textarea>
    <button class="close-btn" id="closeOverlay">Schließen</button>
  </div>
</div>

<script>
// ---------- Helper ----------
function parseNum(value){
  if(!value) return 0;
  return parseFloat(value.replace(/\./g,"").replace(",",".")) || 0;
}
function fmt(num,dec=0){return isFinite(num)?num.toLocaleString("de-DE",{minimumFractionDigits:dec,maximumFractionDigits:dec}):"–";}

// ---------- Eingabe-Formatierung ----------
function formatInput(e){
  const el=e.target;
  const clean=parseNum(el.value);
  if(el.type==="text" && el!==document.getElementById("conversionRate"))
    el.value=clean?fmt(clean,2).replace(",00",""):el.value;
}

// ---------- Hauptberechnung ----------
let base={};

function updateNet(){
  const gross=parseNum(document.getElementById("bonGross").value);
  const net=gross/1.19;
  document.getElementById("bonNet").value=net?fmt(net,2):"";
}

function computeBase(){
  updateNet();

  const totalRevenue=parseNum(document.getElementById("totalRevenue").value);
  const conversionRate=parseNum(document.getElementById("conversionRate").value)/100;
  const profit=parseNum(document.getElementById("profit").value);
  const autoEstimate=document.getElementById("autoEstimate").checked;
  const bonGross=parseNum(document.getElementById("bonGross").value);
  const bonNet=bonGross/1.19;
  const productionCost=parseNum(document.getElementById("productionCost").value);
  const shippingCost=parseNum(document.getElementById("shippingCost").value);

  if(!totalRevenue||!conversionRate||!bonGross) return;

  const visitors=totalRevenue/(conversionRate*bonGross);
  document.getElementById("visitorDisplay").textContent="≈ "+fmt(visitors,0)+" Besucher";

  let baseProfit=profit;
  if(autoEstimate){
    const costRatio=productionCost/bonNet;
    const profitPerOrder=bonNet-(bonNet*costRatio)-shippingCost;
    baseProfit=Math.round(visitors*conversionRate*profitPerOrder);
    document.getElementById("profit").value=fmt(baseProfit,0);
  }

  base={totalRevenue,conversionRate,profit:baseProfit,bonGross,bonNet,productionCost,shippingCost,visitors};

  const crSlider=document.getElementById("sliderCr");
  crSlider.min=Math.max(0,(conversionRate*100)-5);
  crSlider.max=(conversionRate*100)+5;
  crSlider.value=conversionRate*100;
  crSlider.dataset.center=crSlider.value;

  const bonSlider=document.getElementById("sliderBon");
  bonSlider.min=Math.round(bonGross*50);
  bonSlider.max=Math.round(bonGross*150);
  bonSlider.value=Math.round(bonGross*100);
  bonSlider.dataset.center=bonSlider.value;

  document.getElementById("bonValue").textContent=fmt(bonGross,2);
  document.getElementById("crValue").textContent=fmt(conversionRate*100,2);

  updateScenario();
}

function updateScenario(){
  if(!base.totalRevenue)return;

  const newBon=parseFloat(document.getElementById("sliderBon").value)/100;
  const newCrPct=parseFloat(document.getElementById("sliderCr").value);
  const newCr=newCrPct/100;

  document.getElementById("bonValue").textContent=fmt(newBon,2);
  document.getElementById("crValue").textContent=fmt(newCrPct,2);

  const visitors=base.visitors;
  const newRevenue=visitors*newCr*newBon;
  const deltaRevenue=newRevenue-base.totalRevenue;
  const deltaRevenuePct=(deltaRevenue/base.totalRevenue)*100;

  const costRatio=base.productionCost/base.bonNet;
  const profitPerOrderNew=(newBon/1.19)-((newBon/1.19)*costRatio)-base.shippingCost;
  const profitPerOrderBase=base.bonNet-(base.bonNet*costRatio)-base.shippingCost;
  const newProfit=visitors*newCr*profitPerOrderNew;
  const baseProfit=visitors*base.conversionRate*profitPerOrderBase;
  const deltaProfit=newProfit-baseProfit;
  const deltaProfitPct=base.profit?(deltaProfit/base.profit)*100:null;

  document.getElementById("deltaRevenueAbs").textContent=(deltaRevenue>=0?"+":"")+fmt(deltaRevenue,0)+" €";
  document.getElementById("deltaRevenueRel").textContent=(deltaRevenue>=0?"+":"")+fmt(deltaRevenuePct,2)+" %";
  document.getElementById("deltaRevenueRel").className="delta "+(deltaRevenue>=0?"positive":"negative");
  document.getElementById("newRevenueTotal").textContent="Gesamt: "+fmt(newRevenue,0)+" €";

  document.getElementById("deltaProfitAbs").textContent=(deltaProfit>=0?"+":"")+fmt(deltaProfit,0)+" €";
  if(base.profit){
    document.getElementById("deltaProfitRel").textContent=(deltaProfit>=0?"+":"")+fmt(deltaProfitPct,2)+" %";
    document.getElementById("deltaProfitRel").className="delta "+(deltaProfit>=0?"positive":"negative");
    document.getElementById("newProfitTotal").textContent="Gesamt: "+fmt(newProfit,0)+" €";
  }else{
    document.getElementById("deltaProfitRel").textContent="";
    document.getElementById("newProfitTotal").textContent="";
  }
}

// ---------- Editable Slider Values ----------
function makeEditable(spanId, sliderId){
  const span=document.getElementById(spanId);
  const slider=document.getElementById(sliderId);

  span.addEventListener("click",()=>{
    const current=span.textContent.replace(/\./g,"").replace(",",".");
    const input=document.createElement("input");
    input.type="text";
    input.value=current;
    Object.assign(input.style,{
      width:"4em", textAlign:"right", border:"none", background:"transparent", color:"#0071e3", fontWeight:"700", outline:"none", fontFamily:"inherit"
    });
    span.replaceWith(input);
    input.focus();
    input.select();

    const commit=()=>{
      let val=parseFloat(input.value.replace(",","."));
      if(!isFinite(val)) val=parseFloat(current);
      input.replaceWith(span);
      if(sliderId==="sliderBon") slider.value=val*100;
      if(sliderId==="sliderCr") slider.value=val;
      updateScenario();
    };

    input.addEventListener("blur",commit);
    input.addEventListener("keydown",e=>{
      if(e.key==="Enter") commit();
      if(e.key==="Escape") input.replaceWith(span);
    });
  });
}

// ---------- Events ----------
document.querySelectorAll('#totalRevenue,#conversionRate,#profit,#bonGross,#productionCost,#shippingCost')
  .forEach(el=>{
    el.addEventListener('input',computeBase);
    el.addEventListener('blur',formatInput);
  });

document.getElementById("autoEstimate").addEventListener("change", ()=>{
  const profitInput=document.getElementById("profit");
  if(!document.getElementById("autoEstimate").checked) profitInput.value="";
  computeBase();
});

document.getElementById("sliderBon").addEventListener("input",updateScenario);
document.getElementById("sliderCr").addEventListener("input",updateScenario);

// 🔁 Reset-Buttons
document.getElementById("resetBon").addEventListener("click",()=>{
  const s=document.getElementById("sliderBon");
  if(s.dataset.center){s.value=s.dataset.center;updateScenario();}
});
document.getElementById("resetCr").addEventListener("click",()=>{
  const s=document.getElementById("sliderCr");
  if(s.dataset.center){s.value=s.dataset.center;updateScenario();}
});

// Editable slider numbers
makeEditable("bonValue","sliderBon");
makeEditable("crValue","sliderCr");

// Overlay
document.getElementById("embedLink").addEventListener("click",e=>{
  e.preventDefault();
  document.getElementById("overlay").style.display="flex";
});
document.getElementById("closeOverlay").addEventListener("click",()=>{
  document.getElementById("overlay").style.display="none";
});
</script>

</body>
</html>
