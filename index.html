<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conversion & Bon Rechner</title>
<style>
body {
  font-family: "Inter", sans-serif;
  background: #f9fafb;
  color: #111;
  padding: 40px;
}
.container {
  max-width: 900px;
  margin: auto;
}
h1 {
  font-size: 28px;
  margin-bottom: 30px;
  text-align: center;
}
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
label {
  font-size: 14px;
  font-weight: 600;
  display: block;
  margin-bottom: 4px;
}
input[type="text"],
input[type="number"] {
  width: 100%;
  padding: 8px;
  font-size: 15px;
  border: 1px solid #ccc;
  border-radius: 8px;
  text-align: right;
  box-sizing: border-box;
}
.radio-wrap {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
#autoEstimate {
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid #aaa;
  cursor: pointer;
  position: relative;
}
#autoEstimate:checked {
  background-color: #666;
  border-color: #666;
}
.slider-container {
  margin-top: 40px;
}
.slider-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.reset-button {
  cursor: pointer;
  color: #666;
  font-size: 16px;
  transition: 0.3s;
}
.reset-button:hover {
  color: #000;
}
input[type="range"] {
  width: 100%;
}
.kacheln {
  display: flex;
  justify-content: space-between;
  margin-top: 40px;
  gap: 20px;
}
.kachel {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 20px;
  flex: 1;
  text-align: center;
}
.kachel h3 {
  font-size: 18px;
  margin-bottom: 8px;
}
.kachel .value {
  font-size: 26px;
  font-weight: 700;
}
.kachel .change {
  font-size: 14px;
  margin-top: 4px;
}
.positive { color: #0a0; }
.negative { color: #c00; }
.footer {
  text-align: center;
  font-size: 13px;
  color: #666;
  margin-top: 40px;
}
</style>
</head>
<body>
<div class="container">
  <h1>Conversion & Bon Rechner</h1>

  <div class="grid">
    <div>
      <label>Gesamtumsatz (€)</label>
      <input id="revenue" type="text" placeholder="z. B. 100.000">

      <label>Conversion Rate (%)</label>
      <input id="cr" type="number" step="0.01" placeholder="z. B. 2,5">

      <label>Ertrag (optional, €)</label>
      <input id="profit" type="text" placeholder="z. B. 15.000">

      <div class="radio-wrap">
        <input type="checkbox" id="autoEstimate">
        <label for="autoEstimate">Ertrag automatisch ergänzen</label>
      </div>

      <label>Besucherzahl (automatisch)</label>
      <input id="visitors" type="text" readonly>
    </div>

    <div>
      <label>Bon (brutto, €)</label>
      <input id="bon" type="text" placeholder="z. B. 40">
      <label>Bon (netto, €)</label>
      <input id="bonNet" type="text" readonly>
      <label>Herstellungskosten (€)</label>
      <input id="cost" type="text" placeholder="z. B. 8">
      <label>Versandkosten (€)</label>
      <input id="ship" type="text" placeholder="z. B. 4">
    </div>
  </div>

  <div class="slider-container">
    <div class="slider-header">
      <span>Conversion Rate</span>
      <span class="reset-button" id="resetCR">⟳</span>
    </div>
    <input type="range" id="crSlider" min="-50" max="50" step="0.1" value="0">

    <div class="slider-header" style="margin-top:30px;">
      <span>Bon</span>
      <span class="reset-button" id="resetBon">⟳</span>
    </div>
    <input type="range" id="bonSlider" min="-50" max="50" step="0.1" value="0">
  </div>

  <div class="kacheln">
    <div class="kachel" id="umsatzBox">
      <h3>Zusatz-Umsatz</h3>
      <div class="value" id="addRevenue">0 €</div>
      <div class="change" id="totalRevenueChange"></div>
    </div>
    <div class="kachel" id="ertragBox">
      <h3>Zusatz-Ertrag</h3>
      <div class="value" id="addProfit">0 €</div>
      <div class="change" id="totalProfitChange"></div>
    </div>
  </div>

  <div class="footer">Entwickelt von Kleine — <a href="#">Einbetten</a></div>
</div>

<script>
function parseNumber(v){return parseFloat(v.toString().replace(/\./g,'').replace(',','.'))||0;}
function formatNumber(x){return x.toLocaleString('de-DE',{maximumFractionDigits:0});}

function updateNetBon(){
  const bon=parseNumber(document.getElementById('bon').value);
  document.getElementById('bonNet').value=bon?formatNumber(bon/1.19):'';
}

function computeBase(){
  const rev=parseNumber(document.getElementById('revenue').value);
  const cr=parseNumber(document.getElementById('cr').value)/100;
  const bon=parseNumber(document.getElementById('bon').value);
  if(rev>0 && cr>0 && bon>0){
    const visitors=rev/(cr*bon);
    document.getElementById('visitors').value=formatNumber(visitors);
    if(document.getElementById('autoEstimate').checked){
      const cost=parseNumber(document.getElementById('cost').value);
      const ship=parseNumber(document.getElementById('ship').value);
      const netBon=bon/1.19;
      const x=cost/bon;
      const estProfit=visitors*cr*(netBon-(netBon*x)-ship);
      document.getElementById('profit').value=formatNumber(estProfit);
    }
  }
  updateResults();
}

function updateResults(){
  const rev=parseNumber(document.getElementById('revenue').value);
  const cr=parseNumber(document.getElementById('cr').value)/100;
  const bon=parseNumber(document.getElementById('bon').value);
  const cost=parseNumber(document.getElementById('cost').value);
  const ship=parseNumber(document.getElementById('ship').value);
  const profit=parseNumber(document.getElementById('profit').value);
  const visitors=rev/(cr*bon)||0;

  const crChange=parseFloat(document.getElementById('crSlider').value);
  const bonChange=parseFloat(document.getElementById('bonSlider').value);

  const newCr=Math.max(0,cr+(cr*(crChange/100)));
  const newBon=bon+(bon*(bonChange/100));
  const newBonNet=newBon/1.19;

  const newRevenue=visitors*newCr*newBon;
  const addRevenue=newRevenue-rev;

  const x=cost/bon;
  const profitPerNewOrder=newBonNet-(newBonNet*x)-ship;
  const addProfit=profitPerNewOrder*visitors*newCr;

  document.getElementById('addRevenue').innerText=formatNumber(addRevenue)+' €';
  const revChangePercent=(addRevenue/rev)*100;
  document.getElementById('totalRevenueChange').innerHTML=`Gesamt: ${formatNumber(newRevenue)} € (${revChangePercent>0?'<span class="positive">+':''}${revChangePercent.toFixed(1)} %</span>)`;

  if(profit>0){
    const totalProfit=profit+addProfit;
    const profitChangePercent=(addProfit/profit)*100;
    document.getElementById('addProfit').innerText=formatNumber(addProfit)+' €';
    document.getElementById('totalProfitChange').innerHTML=`Gesamt: ${formatNumber(totalProfit)} € (${profitChangePercent>0?'<span class="positive">+':''}${profitChangePercent.toFixed(1)} %</span>)`;
  }else{
    document.getElementById('addProfit').innerText=formatNumber(addProfit)+' €';
    document.getElementById('totalProfitChange').innerHTML='';
  }
}

['revenue','cr','bon','cost','ship','profit'].forEach(id=>{
  document.getElementById(id).addEventListener('input',()=>{
    const el=document.getElementById(id);
    const val=el.value.replace(/\./g,'');
    if(!isNaN(val) && val!==''){
      el.value=formatNumber(parseNumber(val));
    }
    updateNetBon();
    computeBase();
  });
});

document.getElementById('autoEstimate').addEventListener('change',()=>{
  if(document.getElementById('autoEstimate').checked){
    computeBase();
  }else{
    document.getElementById('profit').value='';
  }
});

document.getElementById('crSlider').addEventListener('input',updateResults);
document.getElementById('bonSlider').addEventListener('input',updateResults);

['crSlider','bonSlider'].forEach(id=>{
  document.getElementById(id).addEventListener('dblclick',()=>{
    document.getElementById(id).value=0;
    updateResults();
  });
});
['resetCR','resetBon'].forEach(id=>{
  document.getElementById(id).addEventListener('click',()=>{
    document.getElementById(id.replace('reset','').toLowerCase()+'Slider').value=0;
    updateResults();
  });
});
</script>
</body>
</html>
